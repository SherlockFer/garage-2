pipeline{
    agent any 
    
    stages{       
        
        stage('Git: Clone') { 
            steps{
                sh "test -e .git && git clean -fdx 2>/dev/null || true"                    
                git credentialsId: "jenkins-rsa", branch: "master", url: "git@github.com:SherlockFer/quickpoll.git"              
            }
        } 
        
        stage('Run test booking'){
            steps{            
                sh "cd garage-api-test && java -jar /opt/karate/karate-0.9.6.jar --env=docker booking.feature user.feature part.feature product.feature"
            }
        }
    }

    post {
        always {
            publishHTML(
                target: [
                    allowMissing: false,
                    alwaysLinkToLastBuild: false,
                    keepAll: true,
                    reportDir: "garage-api-test/target/cucumber-html-reports",
                    reportFiles: 'overview-features.html',
                    reportName: "Report"
                ]
            ) 
        }
    }
}